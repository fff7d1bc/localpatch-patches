From 375d52dfd7a45fe9ab092b59c6afde4c0afd6b54 Mon Sep 17 00:00:00 2001
From: Piotr Karbowski <piotr.karbowski@gmail.com>
Date: Sat, 4 Jun 2011 00:27:07 +0200
Subject: [PATCH] Fixing build process for post-2.6.39 kernels.

---
 kernel/conftest.sh |    2 +-
 kernel/nv-linux.h  |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/kernel/conftest.sh b/kernel/conftest.sh
index ac48d68..8864e79 100755
--- a/kernel/conftest.sh
+++ b/kernel/conftest.sh
@@ -76,7 +76,7 @@ test_xen() {
 }
 
 build_cflags() {
-    BASE_CFLAGS="-D__KERNEL__ \
+    BASE_CFLAGS="-O2 -D__KERNEL__ \
 -DKBUILD_BASENAME=\"#conftest$$\" -DKBUILD_MODNAME=\"#conftest$$\" \
 -nostdinc -isystem $ISYSTEM"
 
diff --git a/kernel/nv-linux.h b/kernel/nv-linux.h
index 46a4ee0..b7c54d5 100644
--- a/kernel/nv-linux.h
+++ b/kernel/nv-linux.h
@@ -32,7 +32,7 @@
 #  define KERNEL_2_4
 #elif LINUX_VERSION_CODE < KERNEL_VERSION(2, 6, 0)
 #  error This driver does not support 2.5 kernels!
-#elif LINUX_VERSION_CODE < KERNEL_VERSION(2, 7, 0)
+#elif LINUX_VERSION_CODE < KERNEL_VERSION(3, 1, 0)
 #  define KERNEL_2_6
 #else
 #  error This driver does not support development kernels!
-- 
1.7.5.3

